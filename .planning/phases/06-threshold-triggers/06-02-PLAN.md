---
phase: 06-threshold-triggers
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - max/imu-sensor.maxhelp
  - .planning/ROADMAP.md
  - .planning/STATE.md
autonomous: true

must_haves:
  truths:
    - "Help patch Recipe 2 (Gesture Triggers) works end-to-end: test signal fires thresholds, output appears on outlet 12 as documented"
    - "Threshold message examples in help patch Message Reference section match the implemented API"
    - "ROADMAP.md Phase 4 shows 2/3 plans complete (not 3/3) and Phase 6 shows correct plan list"
    - "STATE.md reflects Phase 6 completion with updated position, decisions, and metrics"
  artifacts:
    - path: "max/imu-sensor.maxhelp"
      provides: "Updated Recipe 2 matching working threshold implementation, corrected message examples"
    - path: ".planning/ROADMAP.md"
      provides: "Accurate progress table with Phase 4 at 2/3 and Phase 6 plans listed"
    - path: ".planning/STATE.md"
      provides: "Updated project state reflecting Phase 6 completion"
  key_links:
    - from: "help patch Recipe 2 threshold messages"
      to: "imu-sensor.maxpat threshold handler"
      via: "message boxes send 'threshold pitch 45' to abstraction inlet, triggers appear on outlet 12"
    - from: "help patch outlet documentation"
      to: "imu-sensor.maxpat outlet 13 (index)"
      via: "outlet 12 documented as 'Triggers: axis direction (e.g., pitch up)'"
---

<objective>
Update the help patch Recipe 2 to match the actual threshold implementation from Plan 01, correct threshold message examples in the Message Reference, and update ROADMAP.md and STATE.md to accurately reflect project completion status.

Purpose: Closes the false documentation gap (help patch documents non-existent API) and ensures project tracking files are accurate. This is the final gap closure for v1.0.
Output: Working help patch Recipe 2, accurate ROADMAP and STATE files.
</objective>

<execution_context>
@/Users/taylorbrook/.claude/get-shit-done/workflows/execute-plan.md
@/Users/taylorbrook/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-threshold-triggers/06-RESEARCH.md
@.planning/phases/06-threshold-triggers/06-01-SUMMARY.md
@max/imu-sensor.maxhelp
@max/imu-sensor.maxpat
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update help patch Recipe 2 and threshold message examples</name>
  <files>max/imu-sensor.maxhelp</files>
  <action>
Read imu-sensor.maxhelp and locate:

**A. Recipe 2: Gesture Triggers (lines ~1650-1920 per research)**
Update Recipe 2 to match the actual threshold implementation from Plan 01. The recipe should demonstrate:
1. Setting a threshold: clickable message `threshold pitch 45` connected to the abstraction's control inlet
2. Setting threshold with hysteresis: clickable message `threshold pitch 45 10`
3. Receiving trigger output: outlet 12 output routed through `route pitch roll` to show `up`/`down` messages
4. A `button` object that flashes on each trigger for visual feedback
5. Comment boxes explaining: what thresholds do, what hysteresis prevents, and musical application (e.g., "Tilt past 45 degrees triggers a note-on")

Verify the Recipe 2 wiring connects to the correct outlet of the live [imu-sensor] instance in the help patch. The triggers outlet is outlet 12 (0-based) of the abstraction.

**B. Message Reference section (threshold messages, lines ~860-910 per research)**
Verify the threshold message examples match the implemented API:
- `threshold pitch 45` -- sets pitch threshold to 45 degrees
- `threshold pitch 45 5` -- sets pitch threshold to 45 with hysteresis 5 (if this format is supported)
- `threshold ax 1.0` -- sets accelerometer X threshold
- `threshold clear` -- clears all thresholds (if implemented; if not, remove this example or note it's not implemented)

Update any message examples that don't match the actual API. Remove any that reference features not implemented (like multi-threshold or threshold clear if those weren't built in Plan 01).

**C. Outlet 12 documentation**
In the outlet documentation section, verify outlet 12 is described as:
- Purpose: Threshold trigger events
- Format: `axis_name direction` (e.g., `pitch up`, `roll down`)
- Axes: pitch, roll, yaw, ax, ay, az

Update if the description doesn't match the implementation.

**Important:** Do NOT add a second [imu-sensor] instance to the help patch. Per Phase 5 decisions, the help patch uses a single live instance to avoid resource contention. Recipe 2 should reference the same instance used by other recipes.
  </action>
  <verify>
1. Read the updated help patch JSON and verify Recipe 2 contains threshold message boxes connected to the abstraction inlet
2. Verify Recipe 2 has a route object on outlet 12 output
3. Verify threshold message examples in Message Reference match the API format
4. Verify outlet 12 documentation describes trigger output format
5. JSON is valid
  </verify>
  <done>
Help patch Recipe 2 demonstrates working threshold triggers with correct message format, outlet routing, and hysteresis explanation. Message Reference threshold examples match the implemented API. Outlet 12 documentation accurately describes trigger output.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ROADMAP.md and STATE.md with accurate completion status</name>
  <files>.planning/ROADMAP.md, .planning/STATE.md</files>
  <action>
**A. ROADMAP.md updates:**

1. Phase 4 progress table: Change `2/3` to `2/3` (verify it currently says wrong value). Per research, it shows "Partial (04-03 not executed)" which is correct but the plan list shows 3 plans with unchecked 04-03. Verify accuracy.

2. Phase 6 plan list: Update from placeholder:
```
Plans:
- [ ] 06-01-PLAN.md -- Threshold subpatchers with hysteresis in imu-sensor.maxpat abstraction
- [ ] 06-02-PLAN.md -- Help patch Recipe 2 fix and project documentation updates
```

3. Phase 6 progress row: Update plan count.

**B. STATE.md updates:**

1. Current Position: Update to Phase 6 with correct plan count and status
2. Performance Metrics: Add Phase 6 row to the table with actual duration
3. Accumulated Context > Decisions: Add Phase 6 decisions:
   - "Thresholds implemented in MAX, not Node -- follows architecture pattern where musical features live in MAX"
   - "Single configurable threshold per axis with adjustable hysteresis -- multi-threshold deferred to v2"
   - "Direct wiring from smoothed data to threshold subpatchers (not send/receive) -- simplest instance isolation"
4. Pending Todos: None
5. Session Continuity: Update last session info

Do NOT mark Phase 6 plans as [x] complete in ROADMAP.md -- the executor will do that after this plan runs successfully.
  </action>
  <verify>
1. ROADMAP.md Phase 4 progress shows 2/3 (not 3/3)
2. ROADMAP.md Phase 6 lists 2 plans with correct descriptions
3. STATE.md current position reflects Phase 6
4. STATE.md has Phase 6 metrics row
5. STATE.md decisions include Phase 6 threshold decisions
  </verify>
  <done>
ROADMAP.md accurately reflects Phase 4 at 2/3, Phase 6 with 2 plans listed. STATE.md reflects Phase 6 position, metrics, and decisions. All audit gaps in project tracking are closed.
  </done>
</task>

</tasks>

<verification>
1. Open imu-sensor.maxhelp in MAX
2. Start test signal
3. Send `threshold pitch 45` via Recipe 2's clickable message
4. Verify outlet 12 fires `pitch up`/`pitch down` as the test signal's pitch oscillates
5. Verify ROADMAP.md and STATE.md are internally consistent with actual project state
</verification>

<success_criteria>
- Help patch Recipe 2 works end-to-end with the threshold implementation
- Threshold message examples in help patch match implemented API
- ROADMAP.md Phase 4 shows 2/3 (accurate)
- ROADMAP.md Phase 6 lists 2 plans with descriptions
- STATE.md reflects Phase 6 completion
- No false documentation remains
</success_criteria>

<output>
After completion, create `.planning/phases/06-threshold-triggers/06-02-SUMMARY.md`
</output>
